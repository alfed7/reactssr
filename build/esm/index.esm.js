import{renderToString as r}from"react-dom/server";import{StaticRouter as t}from"react-router-dom/server";import{Routes as e}from"react-router-dom";import{renderRoutes as o}from"react-router-layout";import{HelmetProvider as n}from"react-helmet-async";import a from"serialize-javascript";import{RootContextProvider as c,createServerStore as i}from"react-reducer-ssr";import{jsx as m}from"react/jsx-runtime";import{matchRoutes as s}from"react-router";import p from"parseurl";import u from"fs";var d=function(i,s,p,u,d){var f={},l=m(t,{location:u.url,children:m(n,{context:f,children:m(c,{reducer:i,initialState:null==d?void 0:d.root,children:m(e,{children:o(p)})})})}),v=r(l),h="production"===process.env.NODE_ENV?'<script src="/service-worker.js" defer><\/script>':"",x=f.helmet,S=x&&x.title?x.title.toString():"",T=x&&x.meta?x.meta.toString():"";return s.replace('<div id="app"></div>','<div id="app">'.concat(v,"</div>\n      <script>\n        window.INITIAL_STATE = ").concat(a(d.root),"\n      <\/script>\n      ").concat(h)).replace("\x3c!-- META --\x3e","".concat(S,"\n      ").concat(T))},f=function(r,t,e){return function(o,n,a){var c=p(o),m=c?c.search:"",f=c?c.pathname:"",v=i(t,{}),h=u.readFileSync(r,"utf8"),x=s(e,f||"");if(!x)return n.statusCode=404,void a("Not found");var S=x.map((function(r){var t=r.route;return t.loadData?t.loadData(v.dispatch,o.cookies,m):null})).map((function(r){if(r)return new Promise((function(t){r.then(t).catch(t)}))}));Promise.all(S).then((function(){var r=d(t,h,e,o,v);l(n,r),a()})).catch((function(r){l(n,"Error happens: "+r),a()}))}};function l(r,t){r.statusCode=r.statusCode||200,r.setHeader("Content-Type","text/html; charset=UTF-8"),r.end(t)}export{f as reactSsr,d as renderHtml};
