import{renderToString as r}from"react-dom/server";import{StaticRouter as t}from"react-router-dom/server";import{Routes as e}from"react-router-dom";import{renderRoutes as o}from"react-router-layout";import{HelmetProvider as a}from"react-helmet-async";import c from"serialize-javascript";import{RootContextProvider as i,createServerStore as n}from"react-reducer-ssr";import{jsx as s}from"react/jsx-runtime";import{matchRoutes as m}from"react-router";import p from"parseurl";import u from"fs";var d=function(n,m,p,u,d){var f={},l=s(t,{location:u.url,children:s(a,{context:f,children:s(i,{reducer:n,initialState:null==d?void 0:d.root,children:s(e,{children:o(p)})})})}),v=r(l),h="production"===process.env.NODE_ENV?'<script src="/static/js/service-worker.js" defer><\/script>':"",x=f.helmet,S=x&&x.title?x.title.toString():"",T=x&&x.meta?x.meta.toString():"";return m.replace('<div id="app"></div>','<div id="app">'.concat(v,"</div>\n      <script>\n        window.INITIAL_STATE = ").concat(c(d.root),"\n      <\/script>\n      ").concat(h)).replace("\x3c!-- META --\x3e","".concat(S,"\n      ").concat(T))},f=function(r,t,e){return function(o,a,c){var i=p(o),s=i?i.search:"",f=i?i.pathname:"",v=n(t,{}),h=u.readFileSync(r,"utf8"),x=m(e,f||"");if(!x)return a.statusCode=404,void c("Not found");var S=x.map((function(r){var t=r.route;return t.loadData?t.loadData(v.dispatch,o.cookies,s):null})).map((function(r){if(r)return new Promise((function(t){r.then(t).catch(t)}))}));Promise.all(S).then((function(){var r=d(t,h,e,o,v);l(a,r),c()})).catch((function(r){l(a,"Error happens: "+r),c()}))}};function l(r,t){r.statusCode=r.statusCode||200,r.setHeader("Content-Type","text/html; charset=UTF-8"),r.end(t)}export{f as reactSsr,d as renderHtml};
